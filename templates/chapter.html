{% extends "base.html" %}
{% import "form_make.html" as wtf %}

{% block title %}{{ title }}{% endblock %}

{% block body_attrs %}data-book="{{ content.get('book') }}" data-chapter="{{ content.get('chapter') }}"{% endblock %}

{% block content %}
<div class="reader-container">
    
    <!-- Header Navigation Bar -->
    <div class="reader-header">
        <div class="reader-nav-controls">
            <!-- Navigation Form -->
            <form method="post" class="nav-form nav-buttons">
                {{ form.hidden_tag() }}
                <div class="nav-left">
                    {{ wtf.form_field(form.previous_button, class="nav-btn prev-btn") }}
                </div>
            </form>
            
            <!-- Passage Selection Form -->
            <form method="post" class="nav-form passage-form">
                {{ passage_form.hidden_tag() }}
                <div class="nav-center">
                    <div class="passage-selector">
                        <label for="book" hidden aria-label="Book selection"></label>
                        {{ wtf.passage_field(passage_form.book) }}
                        <label for="chapter" hidden aria-label="Chapter selection"></label>
                        {{ wtf.passage_field(passage_form.chapter) }}
                        {{ wtf.form_field(passage_form.submit, class="go-btn") }}
                    </div>
                    
                    <div class="version-selector">
                        <label for="select_version" hidden aria-label="Version selection"></label>
                        {{ wtf.passage_field(version_select.select_version, size=5) }}
                    </div>
                </div>
            </form>
            
            <!-- Navigation Form -->
            <form method="post" class="nav-form nav-buttons">
                {{ form.hidden_tag() }}
                <div class="nav-right">
                    {{ wtf.form_field(form.next_button, class="nav-btn next-btn") }}
                </div>
            </form>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="reader-content">
        <div class="chapter-header">
            <h1 class="chapter-title">{{ content.get('book') }} {{ content.get('chapter') }}</h1>
            <span class="version-label">{{ version }}</span>
        </div>
        
        <div class="chapter-text">
            {% for heading, verses in content.get('verses').items() %}
                {% if heading != 'none' %}
                    <div class="section-heading">{{ heading }}</div>
                {% endif %}
                
                <div class="verse-section">
                    {% for verse in verses %}
                        <div class="verse">{{ verse|safe }}</div>
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
        
        {% if content.get('footnotes') %}
            <div class="footnotes">
                <h3>Footnotes</h3>
                <div class="footnote-content">{{ content.get('footnotes')|safe }}</div>
            </div>
        {% endif %}
    </div>
    
    <!-- Bottom Navigation -->
    <div class="reader-footer">
        <form method="post" class="footer-nav">
            {{ form.hidden_tag() }}
            <div class="footer-controls">
                {{ wtf.form_field(form.previous_button, class="footer-btn prev") }}
                <span class="chapter-info">{{ content.get('book') }} {{ content.get('chapter') }}</span>
                {{ wtf.form_field(form.next_button, class="footer-btn next") }}
            </div>
        </form>
    </div>
</div>

<style>
.reader-container {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    max-width: 900px;
    margin: 0 auto;
    background: var(--bg-color);
}

.reader-header {
    background: linear-gradient(135deg, var(--primary-accent) 0%, var(--secondary-accent) 100%);
    color: white;
    padding: 1rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    position: sticky;
    top: 0;
    z-index: 100;
}

.reader-nav-controls {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
}

.nav-form {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.nav-form.nav-buttons {
    flex: 0 0 auto;
}

.nav-form.passage-form {
    flex: 1;
    justify-content: center;
}

.nav-left, .nav-right {
    flex: 0 0 auto;
}

.nav-center {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    align-items: center;
}

.passage-selector, .version-selector {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

.nav-btn {
    background: rgba(255,255,255,0.2);
    border: 1px solid rgba(255,255,255,0.3);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
}

.nav-btn:hover {
    background: rgba(255,255,255,0.3);
    transform: translateY(-1px);
}

#book, #chapter, #select_version, .book-select, .chapter-select, .version-select {
    background: var(--dropdown-bg);
    border: none;
    padding: 0.4rem 0.8rem;
    border-radius: 20px;
    color: var(--text-color);
    font-size: 0.9rem;
}

.go-btn {
    background: var(--success-color);
    color: var(--bg-color);
    border: none;
    padding: 0.4rem 1rem;
    border-radius: 20px;
    cursor: pointer;
    font-weight: 500;
}

.go-btn:hover {
    background: color-mix(in srgb, var(--success-color) 85%, black 15%);
}

.reader-content {
    flex: 1;
    padding: 2rem 1.5rem;
    line-height: 1.8;
}

.chapter-header {
    text-align: center;
    margin-bottom: 3rem;
}

.chapter-title {
    font-size: 2.5rem;
    font-weight: 300;
    color: var(--text-color);
    margin-bottom: 0.5rem;
}

.version-label {
    color: var(--input-text);
    font-size: 1rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.section-heading {
    font-size: 1.3rem;
    font-weight: 600;
    color: var(--primary-accent);
    margin: 2rem 0 1rem 0;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--border-color);
}

.verse-section {
    margin-bottom: 2rem;
}

.verse {
    font-size: 1.1rem;
    margin-bottom: 1rem;
    color: var(--text-color);
    text-align: justify;
}

.footnotes {
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 1px solid var(--border-color);
}

.footnotes h3 {
    color: var(--primary-accent);
    margin-bottom: 1rem;
}

.footnote-content {
    color: var(--input-text);
    font-size: 0.9rem;
    line-height: 1.6;
}

.reader-footer {
    background: var(--input-bg);
    padding: 1rem;
    border-top: 1px solid var(--border-color);
    position: sticky;
    bottom: 0;
}

.footer-nav {
    display: flex;
    justify-content: center;
}

.footer-controls {
    display: flex;
    align-items: center;
    gap: 2rem;
}

.footer-btn {
    background: var(--primary-accent);
    color: white;
    border: none;
    padding: 0.5rem 1.5rem;
    border-radius: 25px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s ease;
}

.footer-btn:hover {
    background: color-mix(in srgb, var(--primary-accent) 80%, black 20%);
    transform: translateY(-1px);
}

.chapter-info {
    font-weight: 600;
    color: var(--text-color);
    min-width: 150px;
    text-align: center;
}

/* Dark mode handled by CSS variables in static/styles.css */

/* Mobile Responsive */
@media (max-width: 768px) {
    .nav-center {
        flex-direction: column;
        gap: 0.75rem;
    }
    
    .passage-selector {
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .chapter-title {
        font-size: 2rem;
    }
    
    .reader-content {
        padding: 1.5rem 1rem;
    }
    
    .footer-controls {
        gap: 1rem;
    }
    
    .footer-btn {
        padding: 0.4rem 1rem;
        font-size: 0.9rem;
    }
}
</style>

{% endblock %}

{% block nav_script %}
    {{ super() }}
    <script src="{{ url_for('static', filename='chapter_reader.js') }}"></script>
{% endblock %}